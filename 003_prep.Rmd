# Data Preparation
```{r}
load(file = "./core_data/autodata_clean.Rdata")
```


```{r, eval = FALSE}
# total miles
autodata_clean$totalmil <- autodata_clean$age_of_vehicle_years * autodata_clean$annualised_mileage

# loyalty
autodata_clean$loyalty <- autodata_clean$

# reliability
autodata_clean$reliability <- autodata_clean$non_sched_serv_warr / autodata_clean$age_of_vehicle_years

#complex reliability
autodata_clean$crel <- (autodata_clean$sched_serv_warr / autodata_clean$non_sched_serv_warr) / autodata_clean$age_of_vehicle_years

# maintainence consistency

# service cost
autodata_clean$scost <-  autodata_clean$total_paid_services / autodata_clean$total_services


```


```{r}
# how to create a variable that described car age is between both total miles and age in years, a car can be old because it has high miles or it can be old because it is old in age as a metric

# not linear? age^2?
```


```{r}
# test and train sets
autodata_purch <- autodata_clean %>% 
  filter(Target == "buy")

autodata_nopurch <- autodata_clean %>% 
  filter(Target != "buy")

#stratified sets

set.seed(85)

autodata_purch_train_ind <- sample(seq_len(nrow(autodata_purch)), floor(nrow(autodata_purch)*0.75),replace = FALSE)
autodata_purch_train <- autodata_purch[autodata_purch_train_ind,]
autodata_purch_test <- autodata_purch[-autodata_purch_train_ind,]

autodata_nopurch_train_ind <- sample(seq_len(nrow(autodata_nopurch)),floor(nrow(autodata_nopurch)*0.75), replace = FALSE)
autodata_nopurch_train <- autodata_nopurch[autodata_nopurch_train_ind,]
autodata_nopurch_test <- autodata_nopurch[-autodata_nopurch_train_ind,]

autodata_train <- rbind(autodata_purch_train, autodata_nopurch_train)
autodata_test <- rbind(autodata_purch_test, autodata_nopurch_test)
```

```{r}
autodata_train_nogen <- autodata_train %>% 
  filter(gender == "NULL", age_band != "NULL")

autodata_train_noage <- autodata_train %>% 
  filter(gender != "NULL", age_band == "NULL")

autodata_train_allvar <- autodata_train %>% 
  filter(gender != "NULL", age_band != "NULL")

autodata_train_novar <- autodata_train %>% 
  filter(gender == "NULL", age_band == "NULL")


# Testing datasets split

autodata_test_nogen <- autodata_test %>% 
  filter(gender == "NULL", age_band != "NULL")

autodata_test_noage <- autodata_test %>% 
  filter(gender != "NULL", age_band == "NULL")

autodata_test_allvar <- autodata_test %>% 
  filter(gender != "NULL", age_band != "NULL")
  
autodata_test_novar <- autodata_test %>% 
  filter(gender == "NULL", age_band == "NULL")

```


```{r}
preped_data <- c("autodata_train", "autodata_test")
save(list = preped_data, file = "./core_data/autodata_prep.Rdata")

preped_data_split <- c("autodata_train_nogen", "autodata_train_noage", "autodata_train_allvar", "autodata_train_novar", "autodata_test_nogen", "autodata_test_noage", "autodata_test_allvar", "autodata_test_novar")
save(list = preped_data_split, file = "./core_data/autodata_prep_split.Rdata")
```

